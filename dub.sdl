name "dd-dos"
version "0.0.0"
description "Small DOS Virtual Machine"
authors "dd86k"
copyright "Copyright Â© dd86k 2017-2018"
license "MIT"
homepage "https://github.com/dd86k/dd-dos"

###################
# Debug builds
###################

buildType "debug-verbose" {
  targetType "executable"
  buildOptions "debugMode" "debugInfoC"
  dflags "-betterC" "-transition=intpromote" "-vgc" "-vtls" "-v"
}

buildType "debug" {
  targetType "executable"
  buildOptions "debugMode" "debugInfoC"
  dflags "-betterC" "-transition=intpromote"
}

buildType "debug-gdc" {
  targetType "executable"
  buildOptions "debugMode"
}

###################
# Release builds
###################

buildType "release" {
  targetType "executable"
  buildOptions "releaseMode" "optimize"
  dflags "-betterC" "-transition=intpromote"
}

buildType "release-gdc" {
  targetType "executable"
  buildOptions "releaseMode" "optimize"
}

buildType "release-nobounds" {
  targetType "executable"
  buildOptions "releaseMode" "noBoundsCheck" "optimize"
  dflags "-betterC" "-transition=intpromote"
}

buildType "release-inline" {
  targetType "executable"
  buildOptions "releaseMode" "noBoundsCheck" "optimize" "inline"
  dflags "-betterC" "-transition=intpromote"
}

###################
# Tests
###################

buildType "unittest" {
  targetName "tests"
  targetType "executable"
  buildOptions "unittests"
  dflags "-transition=intpromote"

  excludedSourceFiles "src/main.d"
  sourcePaths "tests/"
  importPaths "tests/"
}

buildType "unittest-gdc" {
  targetName "tests"
  targetType "executable"
  buildOptions "unittests"

  excludedSourceFiles "src/main.d"
  sourcePaths "tests/"
  importPaths "tests/"
}

buildType "bench" {
  targetName "bench"
  targetType "executable"
  buildOptions "unittests"
  dflags "-transition=intpromote"

  sourcePaths "bench/"
  importPaths "bench/"
  sourceFiles "tests/test_utils.d"
  excludedSourceFiles "src/main.d"
}
